#!/usr/bin/env bash

# Import Current Theme
DIR="$HOME/.config/bspwm"
RASI="$DIR/rofi/themes.rasi"

# List Available Themes
THEMES=(`cat $DIR/themes/themes.txt | cut -d '/' -f1`)

# Theme Elements
prompt="Appearance : Polybar Theme Manager"
mesg="<b>Available Themes</b> : `cat $DIR/themes/themes.txt | cut -d '/' -f1 | wc -l`"

# Rofi CMD
rofi_cmd() {
	rofi -dmenu \
		-p "$prompt" \
		-mesg "$mesg" \
		-sep '|' \
		-markup-rows \
		-theme ${RASI}
}

# Pass variables to rofi dmenu
run_rofi() {
	echo ${THEMES[@]} | sed 's/ /|/g' | sed 's/$/|/' | rofi_cmd
}

# Apply Theme
apply_theme() {
	selected="`run_rofi`"
	current="`cat $DIR/themes/.current`"

	for theme in "${THEMES[@]}"; do
		echo "${THEMES[@]}"
		if [[ -z "$selected" ]]; then
			break
		elif [[ "$selected" == "$theme" ]]; then
			rm -rf "$DIR/themes/default/polybar"
			rm -rf "$DIR/themes/default/rofi"
			cp -vr "$DIR/themes/default/${theme}-polybar" "$DIR/themes/default/polybar"
			cp -vr "$DIR/themes/default/${theme}-rofi" "$DIR/themes/default/rofi"
			xdotool key ctrl+shift+r
			break
		fi
	done
}


apply_theme && exit 0

